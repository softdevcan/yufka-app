{% extends "base.html" %}

{% block title %}Ana Sayfa - Yufka Takip{% endblock %}

{% block content %}
<h2>Bug√ºn√ºn √ñzeti</h2>

<div class="summary-cards">
    <div class="summary-card">
        <div class="label">Toplam √úretim</div>
        <div class="value">
            {% set total_prod = today_production | sum(attribute='total') %}
            {{ total_prod }} adet
        </div>
    </div>
    <div class="summary-card">
        <div class="label">Toplam Satƒ±≈ü</div>
        <div class="value">
            {% set total_sales = today_sales | sum(attribute='total') %}
            {{ total_sales }} adet
        </div>
    </div>
    <div class="summary-card revenue" style="grid-column: span 2;">
        <div class="label">Bug√ºnk√º Gelir</div>
        <div class="value">{{ today_revenue | currency }}</div>
    </div>
</div>

<!-- D√º≈ü√ºk Stok Uyarƒ±sƒ± -->
{% if low_stock_materials or low_stock_products %}
<div class="low-stock-alert">
    <h3>‚ö†Ô∏è D√º≈ü√ºk Stok Uyarƒ±sƒ±</h3>
    <ul>
        {% for item in low_stock_materials %}
        <li>
            <strong>{{ item['name'] }}</strong> (Hammadde):
            {{ "%.1f"|format(item['stock_quantity']) }} {{ item['unit'] }}
        </li>
        {% endfor %}
        {% for item in low_stock_products %}
        <li>
            <strong>{{ PRODUCT_TYPES.get(item['product_type'], item['product_type']) }}</strong> (√úr√ºn):
            {{ item['stock_quantity'] }} adet
        </li>
        {% endfor %}
    </ul>
    <a href="/stock" class="btn-stock-add">Stok Ekle</a>
</div>
{% endif %}

<h2>Hƒ±zlƒ± ƒ∞≈ülemler</h2>

<div class="quick-actions">
    <a href="/production" class="quick-action-btn btn-production">
        <span class="icon">üì¶</span>
        <span>√úretim Giri≈üi</span>
    </a>
    <a href="/sales" class="quick-action-btn btn-sales">
        <span class="icon">üí∞</span>
        <span>Satƒ±≈ü Giri≈üi</span>
    </a>
    <a href="/stock" class="quick-action-btn btn-stock">
        <span class="icon">üì¶</span>
        <span>Stok Giri≈üi</span>
    </a>
    <a href="/reports" class="quick-action-btn btn-reports">
        <span class="icon">üìä</span>
        <span>Raporlar</span>
    </a>
</div>

{% if today_production %}
<h3>Bug√ºnk√º √úretim</h3>
<div class="data-table">
    <table>
        <thead>
            <tr>
                <th>√úr√ºn</th>
                <th class="text-right">Adet</th>
            </tr>
        </thead>
        <tbody>
            {% for item in today_production %}
            <tr>
                <td>{{ product_types.get(item['product_type'], item['product_type']) }}</td>
                <td class="text-right">{{ item['total'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if today_sales %}
<h3>Bug√ºnk√º Satƒ±≈ü</h3>
<div class="data-table">
    <table>
        <thead>
            <tr>
                <th>√úr√ºn</th>
                <th class="text-right">Adet</th>
                <th class="text-right">Gelir</th>
            </tr>
        </thead>
        <tbody>
            {% for item in today_sales %}
            <tr>
                <td>{{ product_types.get(item['product_type'], item['product_type']) }}</td>
                <td class="text-right">{{ item['total'] }}</td>
                <td class="text-right">{{ item['revenue'] | currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<h3>Son ƒ∞≈ülemler</h3>

{% if recent_activities %}
<ul class="activity-list">
    {% for activity in recent_activities %}
    <li class="activity-item">
        <div class="activity-icon {{ activity['type'] }}">
            {% if activity['type'] == 'production' %}üì¶{% else %}üí∞{% endif %}
        </div>
        <div class="activity-details">
            <p class="activity-title">
                {{ product_types.get(activity['product_type'], activity['product_type']) }}
            </p>
            <p class="activity-meta">
                {{ activity['date'] | date }} -
                {% if activity['type'] == 'production' %}√úretim{% else %}Satƒ±≈ü{% endif %}
            </p>
        </div>
        <div class="activity-value">
            {% if activity['type'] == 'sales' %}
            <span class="text-success">{{ activity['total_price'] | currency }}</span>
            {% else %}
            {{ activity['quantity'] }} adet
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<div class="empty-state">
    <div class="icon">üìã</div>
    <p>Hen√ºz i≈ülem bulunmuyor</p>
</div>
{% endif %}
{% endblock %}
